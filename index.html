<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia Pro - Ultimate Rules</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --red-team: #e74c3c;
            --black-team: #3498db;
            --gold: #f1c40f;
            --bg: #0b0b0b;
            --card-bg: #161616;
            --warning: #ff4757;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: #eee; text-align: center; margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: auto; background: var(--card-bg); padding: 15px; border-radius: 25px; border: 1px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.7); }
        
        button { width: 100%; padding: 16px; margin-top: 10px; border-radius: 12px; border: none; font-size: 1.1em; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        .host-btn { background: var(--red-team); color: white; }
        .join-btn { background: var(--black-team); color: white; }
        .back-btn { background: #444; color: #ccc; }
        .reset-btn { background: #2c3e50; color: #fff; }
        .info-btn-toggle { background: #333; color: white; padding: 8px 15px; border-radius: 10px; font-size: 0.8em; float: left; width: auto; margin: 0; }

        .setup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .column { background: #1f1f1f; padding: 10px; border-radius: 15px; border: 1px solid #333; }
        .role-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 0.95em; }
        input[type="number"] { width: 45px; padding: 5px; background: #000; border: 1px solid #444; color: white; border-radius: 5px; text-align: center; font-size: 1.1em; }

        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #111; border-radius: 10px; overflow: hidden; }
        .admin-table th, .admin-table td { padding: 12px; border-bottom: 1px solid #222; text-align: left; }
        .admin-table th { background: #222; color: var(--gold); }
        .role-badge { padding: 4px 8px; border-radius: 5px; font-weight: bold; font-size: 0.9em; }

        .role-card { background: linear-gradient(145deg, #1a1a1a, #252525); border-radius: 25px; padding: 25px 20px; margin-top: 15px; border: 2px solid var(--gold); }
        .role-image-container { width: 100%; max-width: 350px; margin: 0 auto 15px; border-radius: 15px; overflow: hidden; border: 2px solid var(--gold); }
        .role-img { width: 100%; display: block; }
        .role-name-text { color: var(--gold); font-size: 2.8em; margin: 15px 0; text-shadow: 0 0 15px rgba(241, 196, 15, 0.4); font-weight: 900; letter-spacing: 1px; }

        .desc-box { background: #000; padding: 20px; border-radius: 15px; text-align: left; border-left: 5px solid var(--gold); margin-top: 20px; }
        .desc-text { margin-top: 10px; color: #ddd; line-height: 1.6; font-size: 1.15em; }
        .important-note { color: var(--warning); font-weight: bold; display: block; margin-top: 10px; text-transform: uppercase; border: 2px dashed var(--warning); padding: 10px; text-align: center; background: rgba(255, 71, 87, 0.1); border-radius: 8px; }

        .player-tag { background: #2c3e50; padding: 8px 12px; margin: 4px; display: inline-block; border-radius: 10px; font-size: 0.9em; }
        .hidden { display: none; }
        .desc-red { color: var(--red-team); }
        .desc-black { color: var(--black-team); }
        
        #guide-section { text-align: left; background: #222; border-radius: 15px; max-height: 0; overflow: hidden; transition: 0.4s; }
        #guide-section.open { max-height: 2000px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--gold); }
    </style>
</head>
<body>

<div class="container">
    <button class="info-btn-toggle" onclick="toggleGuide()">üìñ ‘¥‘µ’ê‘µ’ê‘ª ’Ñ‘±’ç‘ª’Ü</button>
    <div style="clear:both;"></div>

    <div id="guide-section">
        <div id="guide-content"></div>
    </div>

    <div id="setup-panel">
        <h1 style="color: var(--red-team); margin: 10px 0; letter-spacing: 2px;">MAFIA PRO</h1>
        <div style="background: #222; padding: 10px; border-radius: 12px; color: var(--gold); font-weight: bold;">
            ‘∏’Ü‘¥’Ä‘±’Ü’à’í’ê: <span id="total-all">4</span>
        </div>

        <div class="setup-grid">
            <div class="column">
                <div class="desc-red" style="font-weight:bold; margin-bottom:10px;">‘ø‘±’ê’Ñ‘ª’ê’Ü‘µ’ê: <span id="total-red">2</span></div>
                <div class="role-row"><label>’á’•÷Ä’´÷Ü</label><input type="number" class="r-role" data-name="’á’•÷Ä’´÷Ü" value="1" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>‘≤’™’´’∑’Ø</label><input type="number" class="r-role" data-name="‘≤’™’´’∑’Ø" value="1" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>’Ä’∏’£÷á’∏÷Ä’°’Ø’°’∂</label><input type="number" class="r-role" data-name="’Ä’∏’£÷á’∏÷Ä’°’Ø’°’∂" value="0" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>‘π’´’Ø’∂’°’∫’°’∞</label><input type="number" class="r-role" data-name="‘π’´’Ø’∂’°’∫’°’∞" value="0" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>‘±’£’•’∂’ø</label><input type="number" class="r-role" data-name="‘±’£’•’∂’ø" value="0" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>‘≤’°’≠’ø’°’æ’∏÷Ä</label><input type="number" class="r-role" data-name="‘≤’°’≠’ø’°’æ’∏÷Ä" value="0" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>’î’°’≤’°÷Ñ’°÷Å’´</label><input type="number" class="r-role" data-name="’î’°’≤’°÷Ñ’°÷Å’´" value="0" min="0" oninput="calculate()"></div>
            </div>
            <div class="column">
                <div class="desc-black" style="font-weight:bold; margin-bottom:10px;">’ç‘µ’é‘µ’ê: <span id="total-black">2</span></div>
                <div class="role-row"><label>’Ñ’°÷Ü’´’°</label><input type="number" class="b-role" data-name="’Ñ’°÷Ü’´’°" value="1" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>‘¥’∏’∂</label><input type="number" class="b-role" data-name="‘¥’∏’∂" value="1" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>‘≥’∏’≤</label><input type="number" class="b-role" data-name="‘≥’∏’≤" value="0" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>‘≥’•’≤’•÷Å’Ø’∏÷Ç’∞’´</label><input type="number" class="b-role" data-name="‘≥’•’≤’•÷Å’Ø’∏÷Ç’∞’´" value="0" min="0" oninput="calculate()"></div>
                <div class="role-row"><label>’Ä’•’≤’°÷É’∏’≠’°’Ø’°’∂</label><input type="number" class="b-role" data-name="’Ä’•’≤’°÷É’∏’≠’°’Ø’°’∂" value="0" min="0" oninput="calculate()"></div>
            </div>
        </div>
        <button class="host-btn" onclick="startHost()">’ç’è‘µ’Ç‘æ‘µ‘º ’ç‘µ’Ü’Ö‘±‘ø</button>
        <button class="join-btn" onclick="showJoinPanel()">’Ñ‘ª‘±’Ü‘±‘º</button>
    </div>

    <div id="host-lobby" class="hidden">
        <h2 style="color:var(--gold); margin:5px 0;">‘ø’à‘¥’ù <span id="room-code-txt">....</span></h2>
        
        <div id="admin-view-content">
            <p>’ç’∫’°’Ω’∏÷Ç’¥ ’•’∂÷Ñ ’¥’°’Ω’∂’°’Ø’´÷Å’∂’•÷Ä’´’∂...</p>
            <div id="player-list-display"></div>
            <button class="host-btn" onclick="distributeFinal()">‘≤‘±‘∫‘±’Ü‘µ‘º ‘¥‘µ’ê‘µ’ê‘∏</button>
        </div>

        <button class="back-btn" onclick="goBack('setup-panel')">’Ä‘µ’è</button>
        <button class="reset-btn" onclick="resetGame()">‘∂’ê’à’Ö‘±’ë’Ü‘µ‘º</button>
    </div>

    <div id="join-panel" class="hidden">
        <h2>’Ñ‘ª‘±’Ü‘±‘º</h2>
        <input type="number" id="join-code" placeholder="‘ø’∏’§’®" style="width:100%; padding:15px; box-sizing:border-box; border-radius:10px; margin-bottom:10px;">
        <input type="text" id="p-name" placeholder="’Å’•÷Ä ’°’∂’∏÷Ç’∂’®" style="width:100%; padding:15px; box-sizing:border-box; border-radius:10px; margin-bottom:10px;">
        <button class="join-btn" onclick="joinNow()">’Ñ’è’Ü‘µ‘º</button>
        <button class="back-btn" onclick="goBack('setup-panel')">’Ä‘µ’è</button>
    </div>

    <div id="role-display-panel" class="hidden"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDioEbxtAS5wuVGDUuZBf-yTk_qjItE0hM",
        authDomain: "mafia-83663.firebaseapp.com",
        databaseURL: "https://mafia-83663-default-rtdb.firebaseio.com",
        projectId: "mafia-83663",
        storageBucket: "mafia-83663.firebasestorage.app",
        messagingSenderId: "686983745870",
        appId: "1:686983745870:web:2f2d8c03cd0a5b625b0e1f"
    };

    const roleData = {
        "‘±’£’•’∂’ø": { 
            team: "‘ø‘±’ê’Ñ‘ª’ê", 
            img: "https://i.postimg.cc/2yNDpGYD/’°’£’•’∂’ø.png", 
            desc: "‘ø’°÷Ä’¥’´÷Ä ’≠’°’≤’°÷Å’∏’≤ ’ß: ’Ü’° ’°÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’º’°’ª’´’∂ ’£’´’∑’•÷Ä’® ’Ñ’°÷Ü’´’°’µ’´ ’∞’•’ø ’¥’´’°’™’°’¥’°’∂’°’Ø ÷á ’ø’•’Ω’∂’∏÷Ç’¥ ’ß ’¢’∏’¨’∏÷Ä ’Ω÷á’•÷Ä’´’∂ ’§’•’¥÷Ñ’∏’æ: ’Ü’° ’∫’•’ø÷Ñ ’ß ’©’°÷Ñ’∏÷Ç’∂ ÷Ö’£’∂’´ ÷Ñ’°’≤’°÷Ñ’´’∂ ’£’ø’∂’•’¨ ’¥’°÷Ü’´’°’∂’•÷Ä’´’∂: <br><span class='important-note'>‚ö†Ô∏è ‘Ω’ç’è‘ª’é ‘±’ê‘≥‘µ‘º’é’à’í’Ñ ‘∑ ‘≤‘±’ë‘±’Ä‘±’Ö’è‘µ‘º ‘ª’ê ‘¥‘µ’ê‘∏:</span>" 
        },
        "’á’•÷Ä’´÷Ü": { 
            team: "‘ø‘±’ê’Ñ‘ª’ê", 
            img: "https://i.postimg.cc/dtBKXGS6/’∑’•÷Ä’´÷Ü.png", 
            desc: "‘ø’°÷Ä’¥’´÷Ä ’©’´’¥’´ ’°’º’°’ª’∂’∏÷Ä’§’∂ ’ß: ‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷á ’Ω’ø’∏÷Ç’£’∏÷Ç’¥ ’¥’•’Ø ’≠’°’≤’°÷Å’∏’≤’´: ‘Ω’°’≤’°’æ’°÷Ä’® ’∂÷Ä’°’∂ ÷Å’∏÷Ç’µ÷Å ’ß ’ø’°’¨’´’Ω’ù ’®’∂’ø÷Ä’æ’°’Æ ’¥’°÷Ä’§’® ’Ø’°÷Ä’¥’´÷Ä ’ß, ’©’• ’Ω÷á: ’ë’•÷Ä’•’Ø’® ’∫’•’ø÷Ñ ’ß ’°’º’°’ª’∂’∏÷Ä’§’´ ÷Ñ’°’≤’°÷Ñ’´’∂:" 
        },
        "‘≤’™’´’∑’Ø": { 
            team: "‘ø‘±’ê’Ñ‘ª’ê", 
            img: "https://i.postimg.cc/qB2rsPc2/‘≤’™’´’∑’Ø.png", 
            desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷á ’®’∂’ø÷Ä’∏÷Ç’¥ ’¥’•’Ø ’¥’°’Ω’∂’°’Ø÷Å’´, ’∏÷Ç’¥ ÷Å’°’∂’Ø’°’∂’∏÷Ç’¥ ’ß ’¢’∏÷Ç’™’•’¨: ‘µ’©’• ’¥’°÷Ü’´’°’∂ ’°’µ’§ ’£’´’∑’•÷Ä ’Ø÷Ä’°’Ø’•’¨ ’ß ’°’µ’§ ’¥’°÷Ä’§’∏÷Ç ’æ÷Ä’°, ’∂’° ’π’´ ’¥’°’∞’°’∂’∏÷Ç’¥ ÷á ’¥’∂’∏÷Ç’¥ ’ß ’≠’°’≤’´ ’¥’•’ª:" 
        },
        "’Ä’∏’£÷á’∏÷Ä’°’Ø’°’∂": { 
            team: "‘ø‘±’ê’Ñ‘ª’ê", 
            img: "https://i.postimg.cc/fWYscG7M/’∞’∏’£÷á’∏÷Ä’°’Ø’°’∂.png", 
            desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷á ’Ω’ø’∏÷Ç’£’∏÷Ç’¥ ’¥’•’Ø ’≠’°’≤’°÷Å’∏’≤’´: ’Ü’° ’´’¥’°’∂’∏÷Ç’¥ ’ß ’≠’°’≤’°÷Å’∏’≤’´ ’Ä’ç’è‘±‘ø ’§’•÷Ä’®: <br><span class='important-note'>‚ö†Ô∏è ’Ü‘± ‘ª’ê‘±’é’à’í’Ü’î ’â’à’í’Ü‘ª ‘Ω’à’ç’è’à’é‘±’Ü‘µ‘º’à’í ‘ø‘±’Ñ ‘≤‘±’ë‘±’Ä‘±’Ö’è‘µ‘º’à’í ‘ª’ê ‘¥‘µ’ê‘∏ ’Ñ’Ö’à’í’ç’Ü‘µ’ê‘ª’Ü:</span>" 
        },
        "‘π’´’Ø’∂’°’∫’°’∞": { 
            team: "‘ø‘±’ê’Ñ‘ª’ê", 
            img: "https://i.postimg.cc/SRLpm9QG/’©’´’Ø’∂’°’∫’°’∞.png", 
            desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’£’´’∑’•÷Ä’® ÷á ’∫’°’∑’ø’∫’°’∂’∏÷Ç’©’µ’°’∂ ’ø’°’Ø ’°’º’∂’∏÷Ç’¥ ’¥’•’Ø’´’∂: ‘µ’©’• ’¥’°÷Ü’´’°’∂ ’Ø÷Ä’°’Ø’∏÷Ç’¥ ’ß ’∫’°’∑’ø’∫’°’∂’æ’∏’≤’´ ’æ÷Ä’°, ’¶’∏’∞’æ’∏÷Ç’¥ ’ß ‘π’´’Ø’∂’°’∫’°’∞’® ’∂÷Ä’° ÷É’∏’≠’°÷Ä’•’∂:" 
        },
        "‘≤’°’≠’ø’°’æ’∏÷Ä": { 
            team: "‘ø‘±’ê’Ñ‘ª’ê", 
            img: "https://i.postimg.cc/6qVNBZ6T/’¢’°’≠’ø’°’æ’∏÷Ä.png", 
            desc: "’à÷Ç’∂’´ ’•÷Ä’Ø’∏÷Ç ’Ø’µ’°’∂÷Ñ: ‘µ’©’• ’£’´’∑’•÷Ä’® ’∂÷Ä’° ’æ÷Ä’° ’Ø÷Ä’°’Ø’∏÷Ç’¥ ’•’∂ ’Ø’°’¥ ÷Å’•÷Ä’•’Ø’® ’∞’•’º’°÷Å’∂’∏÷Ç’¥ ’•’∂, ’∂’° ’π’´ ’¨÷Ñ’∏÷Ç’¥ ’≠’°’≤’®: ’Ñ’´’°’µ’∂ ’•÷Ä’Ø÷Ä’∏÷Ä’§ ’°’∂’£’°’¥ ’©’´÷Ä’°’≠’°’æ’∏÷Ä’æ’•’¨’∏÷Ç÷Å ’∞’•’ø’∏ ’ß ’§’∏÷Ç÷Ä’Ω ’£’°’¨’´’Ω:" 
        },
        "’î’°’≤’°÷Ñ’°÷Å’´": { 
            team: "‘ø‘±’ê’Ñ‘ª’ê", 
            img: "https://i.postimg.cc/7YDkmKX1/÷Ñ’°’≤’°÷Ñ’°÷Å’´.png", 
            desc: "’Ä’°’Ω’°÷Ä’°’Ø ’Ø’°÷Ä’¥’´÷Ä ’≠’°’≤’°÷Å’∏’≤: ‘≥’´’∑’•÷Ä’® ÷Ñ’∂’∏÷Ç’¥ ’ß: ’Ü÷Ä’° ’¶’•’∂÷Ñ’® ’ø÷Ä’°’¥’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂’∂ ’ß, ’¨’Ω’∏’≤’∏÷Ç’©’µ’∏÷Ç’∂’® ÷á ÷Å’•÷Ä’•’Ø’°’µ’´’∂ ÷Ñ’æ’•’°÷Ä’Ø’∏÷Ç’©’µ’∏÷Ç’∂’®: ’ä’•’ø÷Ñ ’ß ’£’ø’∂’´ ’Ω÷á’•÷Ä’´’∂ ÷á ’∞’°’¥’∏’¶’´ ÷Ñ’°’≤’°÷Ñ’´’∂ ’∞’•’º’°÷Å’∂’•’¨ ’∂÷Ä’°’∂÷Å:" 
        },
        "’Ñ’°÷Ü’´’°": { 
            team: "’ç‘µ’é", 
            img: "https://i.postimg.cc/yYPz50rt/’¥’°÷Ü’´’∏’¶.png", 
            desc: "’ç÷á ’©’´’¥’´ ’¶’´’∂’æ’∏÷Ä’∂ ’ß: ‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ‘¥’∏’∂’´ ÷á ’¥’µ’∏÷Ç’Ω ’¥’°÷Ü’´’°’∂’•÷Ä’´ ’∞’•’ø: ’Ü÷Ä’°’∂÷Ñ ’∞’°’¥’°’±’°’µ’∂’•÷Å’∂’∏÷Ç’¥ ’•’∂ ÷á ’Ø÷Ä’°’Ø’∏÷Ç’¥ ’¥’•’Ø ’Ø’°÷Ä’¥’´÷Ä ’≠’°’≤’°÷Å’∏’≤’´ ’æ÷Ä’°:" 
        },
        "‘¥’∏’∂": { 
            team: "’ç‘µ’é", 
            img: "https://i.postimg.cc/Y0NwtF2h/’§’∏’∂.jpg", 
            desc: "’Ñ’°÷Ü’´’°’µ’´ ’∫’°÷Ä’°’£’¨’∏÷Ç’≠’∂ ’ß: ‘≥’´’∑’•÷Ä’® ’°÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß, ’Ø’°’¶’¥’°’Ø’•÷Ä’∫’∏÷Ç’¥ ’ß ’Ω’∫’°’∂’∏÷Ç’©’µ’∏÷Ç’∂’®: ‘≤’°÷Å’´ ’°’µ’§, ’∏÷Ç’∂’´ ’°’º’°’∂’±’´’∂ ÷Ñ’°’µ’¨’ù ÷É’∂’ø÷Ä’∏÷Ç’¥ ’ß ’á’•÷Ä’´÷Ü’´’∂: ‘Ω’°’≤’°’æ’°÷Ä’® ’∂÷Ä’°’∂ ’∞’∏÷Ç’∑’∏÷Ç’¥ ’ß’ù ’£’ø’°’æ, ’©’• ’∏’π:" 
        },
        "‘≥’∏’≤": { 
            team: "’ç‘µ’é", 
            img: "https://i.postimg.cc/j26rRfq2/’£’∏’≤.png", 
            desc: "’ç÷á ’≠’°’≤’°÷Å’∏’≤ ’ß: ‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’£’´’∑’•÷Ä’® ÷á ’®’∂’ø÷Ä’∏÷Ç’¥ ’¥’•’Ø ’¶’∏’∞’´: ‘±’µ’§ ’≠’°’≤’°÷Å’∏’≤’® ’ø’æ’µ’°’¨ ’£’´’∑’•÷Ä ’Ø’∏÷Ä÷Å’∂’∏÷Ç’¥ ’ß ’´÷Ä ’°’Ø’ø’´’æ ’∏÷Ç’∂’°’Ø’∏÷Ç’©’µ’∏÷Ç’∂’® (’á’•÷Ä’´÷Ü’® ’π’´ ’Ω’ø’∏÷Ç’£’∏÷Ç’¥, ‘≤’™’´’∑’Ø’® ’π’´ ’¢’∏÷Ç’™’∏÷Ç’¥):" 
        },
        "‘≥’•’≤’•÷Å’Ø’∏÷Ç’∞’´": { 
            team: "’ç‘µ’é", 
            img: "https://i.postimg.cc/pVKvfwQL/’£’•’≤’•÷Å’Ø’∏÷Ç’∞’´.png", 
            desc: "’ç÷á ’≠’°’≤’°÷Å’∏’≤ ’ß: ‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’£’´’∑’•÷Ä’® ÷á ’°’µ÷Å’•’¨’∏÷Ç’¥ ’¥’•’Ø’´’∂: ‘±’µ’§ ’≠’°’≤’°÷Å’∏’≤’® ’∞’°’ª’∏÷Ä’§ ’°’¥’¢’∏’≤’ª ÷Å’•÷Ä’•’Ø’® ’π’´ ’Ø’°÷Ä’∏’≤’°’∂’∏÷Ç’¥ ’≠’∏’Ω’•’¨ (÷É’°’Ø’æ’∏÷Ç’¥ ’ß ’¢’•÷Ä’°’∂’®), ’¢’°’µ÷Å ’Ø’°÷Ä’∏’≤ ’ß ÷Ñ’æ’•’°÷Ä’Ø’•’¨:" 
        },
        "’Ä’•’≤’°÷É’∏’≠’°’Ø’°’∂": { 
            team: "’ç‘µ’é", 
            img: "https://i.postimg.cc/PJbkdDf4/’∞’•’≤’°÷É’∏’≠’°’Ø’°’∂.png", 
            desc: "’ç÷á ’≠’°’≤’°÷Å’∏’≤ ’ß: ‘±’¥’¢’∏’≤’ª ’≠’°’≤’´ ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ ’∂÷Ä’° ’®’∂’ø÷Ä’°’Æ ’¥’°÷Ä’§’∏÷Ç’∂ ’Ω’ø’∏÷Ç’£’•’¨’´’Ω ’á’•÷Ä’´÷Ü’∂ ’∏÷Ç ’Ä’∏’£÷á’∏÷Ä’°’Ø’°’∂’® ’Ω’ø’°’∂’∏÷Ç’¥ ’•’∂ ’∞’°’Ø’°’º’°’Ø (’Ω’≠’°’¨) ’∫’°’ø’°’Ω’≠’°’∂:" 
        }
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentRoomCode = "";

    function calculate() {
        let r=0, b=0;
        document.querySelectorAll('.r-role').forEach(i => r += parseInt(i.value)||0);
        document.querySelectorAll('.b-role').forEach(i => b += parseInt(i.value)||0);
        document.getElementById('total-red').innerText = r;
        document.getElementById('total-black').innerText = b;
        document.getElementById('total-all').innerText = r+b;
    }

    function toggleGuide() {
        const guide = document.getElementById('guide-section');
        guide.classList.toggle('open');
        if(guide.classList.contains('open')) {
            let h = "";
            for(let r in roleData) h += `<p style="text-align:left; margin-bottom:15px;"><b style="color:var(--gold); font-size:1.1em;">${r}</b>: ${roleData[r].desc}</p><hr style="border-color:#333;">`;
            document.getElementById('guide-content').innerHTML = h;
        }
    }

    function goBack(id) {
        document.querySelectorAll('.container > div:not(.info-btn-toggle)').forEach(d => d.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function resetGame() { if(confirm("‘∂÷Ä’∏’µ’°÷Å’∂’•’û’¨:")) location.reload(); }

    function startHost() {
        let roles = [];
        document.querySelectorAll('input[type="number"]').forEach(i => {
            for(let k=0; k<(parseInt(i.value)||0); k++) roles.push(i.getAttribute('data-name'));
        });
        currentRoomCode = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('room-code-txt').innerText = currentRoomCode;
        db.ref('rooms/' + currentRoomCode).set({ roles: roles, status: "waiting" });
        goBack('host-lobby');

        db.ref('rooms/' + currentRoomCode + '/players').on('value', snap => {
            const players = snap.val();
            let html = "", adminList = "";
            if(players) {
                adminList = `<table class="admin-table"><tr><th>‘Ω’°’≤’°÷Å’∏’≤</th><th>‘¥’•÷Ä’®</th></tr>`;
                Object.values(players).forEach(p => {
                    html += `<div class="player-tag">üë§ ${p.name}</div>`;
                    let clr = p.role === "’Ω’∫’°’Ω’•÷Ñ..." ? "#777" : (roleData[p.role]?.team === "‘ø‘±’ê’Ñ‘ª’ê" ? "var(--red-team)" : "var(--black-team)");
                    adminList += `<tr><td>${p.name}</td><td><span class="role-badge" style="background:${clr}">${p.role}</span></td></tr>`;
                });
                adminList += `</table>`;
                
                let isDistributed = Object.values(players).some(p => p.role !== "’Ω’∫’°’Ω’•÷Ñ...");
                if(isDistributed) {
                    document.getElementById('admin-view-content').innerHTML = adminList;
                } else {
                    document.getElementById('player-list-display').innerHTML = html;
                }
            }
        });
    }

    function showJoinPanel() { goBack('join-panel'); }

    function joinNow() {
        let c = document.getElementById('join-code').value, n = document.getElementById('p-name').value;
        if(!c || !n) return alert("‘º÷Ä’°÷Å÷Ä’•÷Ñ ’§’°’∑’ø’•÷Ä’®");
        let pRef = db.ref('rooms/' + c + '/players').push();
        pRef.set({ name: n, role: "’Ω’∫’°’Ω’•÷Ñ..." });
        goBack('role-display-panel');

        pRef.on('value', snap => {
            const p = snap.val();
            if(p && p.role !== "’Ω’∫’°’Ω’•÷Ñ...") {
                const d = roleData[p.role];
                document.getElementById('role-display-panel').innerHTML = `
                    <h2 style="margin-bottom:0;">${n}</h2>
                    <div class="role-card">
                        <div class="role-image-container"><img src="${d.img}" class="role-img"></div>
                        <div style="color:#888; font-size:1.1em;">’Å’•÷Ä ’£’°’≤’ø’∂’´ ’§’•÷Ä’∂ ’ß</div>
                        <div class="role-name-text">${p.role}</div>
                        
                        <div class="desc-box">
                            <b style="font-size:1.4em;">‘π’´’¥’ù <span style="color:${d.team==='‘ø‘±’ê’Ñ‘ª’ê'?'var(--red-team)':'var(--black-team)'}">${d.team}</span></b>
                            <p class="desc-text">${d.desc}</p>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('role-display-panel').innerHTML = `<h3>’à’≤’ª’∏÷Ç’µ’∂ ${n}</h3><p style="color:var(--gold); font-size:1.2em;">’ç’∫’°’Ω’•÷Ñ ’≠’°’≤’°’æ’°÷Ä’´’∂...</p>`;
            }
        });
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function distributeFinal() {
        db.ref('rooms/' + currentRoomCode).once('value', snap => {
            let data = snap.val();
            if(!data || !data.players) return alert("’Ñ’°’Ω’∂’°’Ø’´÷Å’∂’•÷Ä ’π’Ø’°’∂");
            
            let keys = Object.keys(data.players);
            let roles = [...data.roles];
            
            while(roles.length < keys.length) roles.push("’î’°’≤’°÷Ñ’°÷Å’´");
            
            roles = shuffleArray(roles); 
            keys = shuffleArray(keys);   
            
            let updates = {};
            keys.forEach((k, i) => {
                updates[k + '/role'] = roles[i];
            });
            
            db.ref('rooms/' + currentRoomCode + '/players').update(updates);
        });
    }
    calculate();
</script>
</body>
</html>
