<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mafia Pro - Ultimate Voting Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --red-team: #ff4757;
            --black-team: #2f3542;
            --blue-team: #3742fa;
            --neutral-team: #05c46b;
            --gold: #f1c40f;
            --bg: #0b0b0b;
            --card-bg: #161616;
            --glass: rgba(255, 255, 255, 0.05);
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg); color: #eee; text-align: center; 
            margin: 0; padding: 10px; -webkit-tap-highlight-color: transparent;
        }
        .container { 
            max-width: 900px; margin: auto; background: var(--card-bg); 
            padding: 15px; border-radius: 25px; border: 1px solid #333; 
            box-shadow: 0 0 30px rgba(0,0,0,0.7); position: relative; 
        }
        
        button { 
            width: 100%; padding: 16px; margin-top: 10px; border-radius: 12px; border: none; 
            font-size: 1.1em; cursor: pointer; font-weight: bold; text-transform: uppercase; 
            transition: 0.3s; touch-action: manipulation;
        }
        .host-btn { background: var(--red-team); color: white; }
        .join-btn { background: var(--blue-team); color: white; }
        .roles-btn { background: #222; color: var(--gold); border: 1px solid var(--gold); }
        .back-btn { background: #444; color: #ccc; }
        .vote-btn { background: var(--gold); color: #000; font-size: 1.3em; }
        .stop-btn { background: #e67e22 !important; color: white !important; font-size: 1.3em; }
        
        .kick-btn { background: #c0392b; color: white; padding: 8px 12px; width: auto; font-size: 1em; border-radius: 8px; margin: 0; }
        .candidate-btn { background: #27ae60; color: white; padding: 8px 12px; width: auto; font-size: 1em; border-radius: 8px; margin: 0; }
        .undo-btn { background: #34495e; color: white; width: auto; padding: 8px 15px; font-size: 0.8em; border-radius: 10px; }

        .setup-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        @media (max-width: 600px) {
            .setup-grid { grid-template-columns: 1fr; } 
        }

        .column { background: #1f1f1f; padding: 10px; border-radius: 15px; border: 1px solid #333; }
        .role-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 0.9em; }
        
        input[type="number"], input[type="text"] { 
            width: 100%; padding: 15px; background: #000; border: 1px solid #444; color: white; 
            border-radius: 12px; box-sizing: border-box; font-size: 1.1em; margin-bottom: 10px; 
        }
        input[type="number"].role-count { width: 45px; padding: 5px; font-size: 1em; margin-bottom: 0; text-align: center; }

        .counter-badge { background: #222; padding: 5px 10px; border-radius: 8px; color: var(--gold); font-size: 0.9em; margin-bottom: 10px; display: inline-block; border: 1px solid #444; }

        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #111; border-radius: 15px; overflow: hidden; font-size: 1.1em; }
        .admin-table td { padding: 12px; border-bottom: 1px solid #222; text-align: left; }
        .role-red-text { color: var(--red-team); font-weight: bold; }
        .role-black-text { color: var(--blue-team); font-weight: bold; }
        .role-neutral-text { color: var(--neutral-team); font-weight: bold; }

        #roles-catalog-overlay, #vote-modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.92); backdrop-filter: blur(8px); 
            z-index: 9000; display: none; align-items: center; justify-content: center; padding: 15px; box-sizing: border-box; 
        }
        .catalog-modal { 
            background: #111; border: 1px solid #444; border-radius: 25px; 
            width: 100%; max-width: 800px; max-height: 85vh; overflow-y: auto; padding: 20px; 
        }
        .role-pill { background: var(--glass); border: 1px solid #333; color: #fff; padding: 10px; border-radius: 10px; margin-bottom: 8px; cursor: pointer; display: flex; justify-content: space-between; font-size: 0.9em; }
        
        .role-card { background: linear-gradient(145deg, #1a1a1a, #252525); border-radius: 20px; padding: 20px; border: 2px solid var(--gold); }
        
        /* ’ñ’´÷Ñ’Ω’æ’°’Æ ’π’°÷É’Ω’•÷Ä’∏’æ ’∂’Ø’°÷Ä’∂’•÷Ä’´ ’Ø’∏’∂’ø’•’µ’∂’•÷Ä */
        .role-image-container { 
            width: 100%; 
            max-width: 300px; 
            aspect-ratio: 2 / 3; 
            margin: 0 auto 15px; 
            border-radius: 15px; 
            overflow: hidden; 
            border: 2px solid var(--gold); 
            background: #111;
        }
        .role-img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            object-position: center top; 
            display: block; 
        }

        .role-name-text { color: var(--gold); font-size: clamp(1.6em, 5vw, 2.5em); font-weight: 900; margin: 10px 0; }
        .desc-box { background: #000; padding: 15px; border-radius: 12px; text-align: left; border-left: 5px solid var(--gold); }
        .desc-text { color: #ccc; font-size: 1em; line-height: 1.4; }

        .vote-result-row { display: flex; justify-content: space-between; background: #222; padding: 10px; margin: 5px 0; border-radius: 8px; border-left: 4px solid var(--gold); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="roles-catalog-overlay">
    <div class="catalog-modal">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 style="color:var(--gold); margin:0;">üé≠ ‘¥‘µ’ê‘µ’ê</h2>
            <button onclick="toggleCatalog()" style="width:auto; padding:5px 15px; background:#444; margin:0;">‚úï</button>
        </div>
        <div class="setup-grid">
            <div><h4 style="color:var(--red-team); margin-top:0;">‘ø‘±’ê’Ñ‘ª’ê</h4><div id="red-cat-list"></div></div>
            <div><h4 style="color:var(--blue-team); margin-top:0;">’ç‘µ’é</h4><div id="black-cat-list"></div></div>
            <div><h4 style="color:var(--neutral-team); margin-top:0;">’â‘µ‘∂’à’î</h4><div id="neutral-cat-list"></div></div>
        </div>
    </div>
</div>

<div id="role-preview-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 10000; padding: 15px; overflow-y: auto;">
    <div style="max-width: 500px; margin: 0 auto;">
        <button class="back-btn" onclick="closePreview()" style="width:auto; padding:10px 25px; margin-bottom:15px;">‚Üê ’Ä‘µ’è</button>
        <div id="preview-content"></div>
    </div>
</div>

<div id="vote-modal-overlay">
    <div class="catalog-modal">
        <h2 id="player-vote-title" style="color: var(--gold);">üó≥Ô∏è ’î’é‘µ‘±’ê‘ø’à’í‘π’Ö’à’í’Ü</h2>
        <div id="candidate-list-player"></div>
        <div id="vote-results-player" class="hidden"></div>
    </div>
</div>

<div class="container">
    <div id="setup-panel">
        <h1 style="color: var(--red-team); margin-top: 5px;">MAFIA PRO</h1>
        <button class="roles-btn" onclick="toggleCatalog()">üìñ ‘¥‘µ’ê‘µ’ê‘ª ’è‘µ’Ç‘µ‘ø‘±’è’à’í</button>
        
        <div style="margin-top:15px;">
            <span class="counter-badge">‘∏’Ü‘¥’Ä‘±’Ü’à’í’ê: <b id="setup-total-all">0</b></span>
            <span class="counter-badge" style="color:var(--red-team)">üî¥ <b id="setup-total-red">0</b></span>
            <span class="counter-badge" style="color:var(--blue-team)">üîµ <b id="setup-total-black">0</b></span>
            <span class="counter-badge" style="color:var(--neutral-team)">üü¢ <b id="setup-total-neutral">0</b></span>
        </div>

        <div class="setup-grid">
            <div class="column">
                <div style="color:var(--red-team); font-weight:bold; margin-bottom:5px;">‘ø‘±’ê’Ñ‘ª’ê</div>
                <div id="setup-red-inputs"></div>
            </div>
            <div class="column">
                <div style="color:var(--blue-team); font-weight:bold; margin-bottom:5px;">’ç‘µ’é</div>
                <div id="setup-black-inputs"></div>
            </div>
            <div class="column">
                <div style="color:var(--neutral-team); font-weight:bold; margin-bottom:5px;">’â‘µ‘∂’à’î</div>
                <div id="setup-neutral-inputs"></div>
            </div>
        </div>
        <button class="host-btn" onclick="startHost()">’ç’è‘µ’Ç‘æ‘µ‘º ’ç‘µ’Ü’Ö‘±‘ø</button>
        <button class="join-btn" onclick="showJoinPanel()">’Ñ‘ª‘±’Ü‘±‘º ‘Ω‘±’Ç‘ª’Ü</button>
    </div>

    <div id="host-lobby" class="hidden">
        <h2 style="color:var(--gold); font-size: 2em; margin: 10px 0;">‘ø’à‘¥’ù <span id="room-code-txt">....</span></h2>
        <div id="player-list-admin"></div>
        <button class="host-btn" id="dist-btn" onclick="distributeFinal()">‘≤‘±‘∫‘±’Ü‘µ‘º ‘¥‘µ’ê‘µ’ê‘∏</button>
        
        <div id="vote-admin-area" class="hidden" style="background: #222; padding: 15px; border-radius: 15px; border: 1px solid var(--gold); margin-top: 15px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="color: var(--gold); margin:0; font-size: 1.2em;">üó≥Ô∏è ’î’é‘µ‘±’ê‘ø’à’í‘π’Ö’à’í’Ü</h3>
                <button class="undo-btn" onclick="undoLastAction()" style="margin:0;">‚Ü©Ô∏è ’Ä‘µ’è ’è‘±‘º</button>
            </div>
            <div id="candidate-list-admin" style="margin:10px 0; text-align:left; font-size: 1.1em;"></div>
            <button id="host-vote-control-btn" class="vote-btn" onclick="toggleVotingState()">’ç‘ø’ç‘µ‘º</button>
            <button class="back-btn" onclick="clearVoteData()">’Ñ‘±’î’ê‘µ‘º</button>
        </div>

        <button class="roles-btn" onclick="toggleCatalog()" style="margin-top: 25px;">üé≠ ‘¥‘µ’ê‘µ’ê‘ª ’ë‘±’Ü‘ø</button>
        <button class="back-btn" onclick="exitGameAndReset()" style="background: #c0392b; color: white;">üõë ‘µ‘º’î (‘∂’ê’à’Ö‘±’ë’Ü‘µ‘º)</button>
    </div>

    <div id="join-panel" class="hidden">
        <h2 style="color: var(--blue-team);">’Ñ‘ª‘±’Ü‘±‘º</h2>
        <input type="number" id="join-code" placeholder="’ç’•’∂’µ’°’Ø’´ ’Ø’∏’§’®">
        <input type="text" id="p-name" placeholder="’Å’•÷Ä ’°’∂’∏÷Ç’∂’®">
        <button class="join-btn" onclick="joinNow()">’Ñ’è’Ü‘µ‘º</button>
        <button class="back-btn" onclick="goBack('setup-panel')">’Ä‘µ’è</button>
    </div>

    <div id="role-display-panel" class="hidden">
        <div id="player-role-info"></div>
        <button class="roles-btn" onclick="toggleCatalog()" style="margin-top: 25px;">üé≠ ‘¥‘µ’ê‘µ’ê‘ª ’ë‘±’Ü‘ø</button>
        <button class="back-btn" onclick="location.reload()" style="margin-top: 10px;">üõë ‘µ‘º’î</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDioEbxtAS5wuVGDUuZBf-yTk_qjItE0hM",
        authDomain: "mafia-83663.firebaseapp.com",
        databaseURL: "https://mafia-83663-default-rtdb.firebaseio.com",
        projectId: "mafia-83663",
        storageBucket: "mafia-83663.firebasestorage.app",
        messagingSenderId: "686983745870",
        appId: "1:686983745870:web:2f2d8c03cd0a5b625b0e1f"
    };

    const roleData = {
        "‘±’£’•’∂’ø": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/2yNDpGYD/’°’£’•’∂’ø.png", desc: "’Ü’° ’°÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’º’°’ª’´’∂ ’£’´’∑’•÷Ä’® ’Ñ’°÷Ü’´’°’µ’´ ’∞’•’ø ’¥’´’°’™’°’¥’°’∂’°’Ø ÷á ’ø’•’Ω’∂’∏÷Ç’¥ ’ß ’¢’∏’¨’∏÷Ä ’Ω÷á’•÷Ä’´’∂ ’§’•’¥÷Ñ’∏’æ: <br>‚ö†Ô∏è ‘Ω’ç’è‘ª’é ‘±’ê‘≥‘µ‘º’é’à’í’Ñ ‘∑ ‘≤‘±’ë‘±’Ä‘±’Ö’è‘µ‘º ‘ª’ê ‘¥‘µ’ê‘∏:" },
        "’á’•÷Ä’´÷Ü": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/dtBKXGS6/’∑’•÷Ä’´÷Ü.png", desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷á ’Ω’ø’∏÷Ç’£’∏÷Ç’¥ ’¥’•’Ø ’≠’°’≤’°÷Å’∏’≤’´: ‘Ω’°’≤’°’æ’°÷Ä’® ’∂÷Ä’°’∂ ÷Å’∏÷Ç’µ÷Å ’ß ’ø’°’¨’´’Ω’ù ’®’∂’ø÷Ä’æ’°’Æ ’¥’°÷Ä’§’® ’Ø’°÷Ä’¥’´÷Ä ’ß, ’©’• ’Ω÷á:" },
        "‘≤’™’´’∑’Ø": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/qB2rsPc2/‘≤’™’´’∑’Ø.png", desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷á ’®’∂’ø÷Ä’∏÷Ç’¥ ’¥’•’Ø ’¥’°’Ω’∂’°’Ø÷Å’´, ’∏÷Ç’¥ ÷Å’°’∂’Ø’°’∂’∏÷Ç’¥ ’ß ’¢’∏÷Ç’™’•’¨: ‘µ’©’• ’¥’°÷Ü’´’°’∂ ’Ø÷Ä’°’Ø’•’¨ ’ß ’∂÷Ä’° ’æ÷Ä’°, ’∂’° ’π’´ ’¥’°’∞’°’∂’∏÷Ç’¥:" },
        "’Ä’∏’£÷á’∏÷Ä’°’Ø’°’∂": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/q7JRqJwk/’∞’∏’£÷á’∏÷Ä’°’Ø’°’∂.png", desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷á ’Ω’ø’∏÷Ç’£’∏÷Ç’¥ ’¥’•’Ø ’≠’°’≤’°÷Å’∏’≤’´: ’Ü’° ’´’¥’°’∂’∏÷Ç’¥ ’ß ’≠’°’≤’°÷Å’∏’≤’´ ’Ä’ç’è‘±‘ø ’§’•÷Ä’®: <br>‚ö†Ô∏è ’â‘ª ‘ø‘±’ê’à’Ç ‘≤‘±’ë‘±’Ä‘±’Ö’è‘µ‘º ‘ª’ê ‘¥‘µ’ê‘∏:" },
        "‘π’´’Ø’∂’°’∫’°’∞": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/SRLpm9QG/’©’´’Ø’∂’°’∫’°’∞.png", desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’£’´’∑’•÷Ä’® ÷á ’∫’°’∑’ø’∫’°’∂’∏÷Ç’¥ ’¥’•’Ø’´’∂: ‘µ’©’• ’¥’°÷Ü’´’°’∂ ’Ø÷Ä’°’Ø’∏÷Ç’¥ ’ß ’∫’°’∑’ø’∫’°’∂’æ’∏’≤’´ ’æ÷Ä’°, ’¶’∏’∞’æ’∏÷Ç’¥ ’ß ‘π’´’Ø’∂’°’∫’°’∞’® ’∂÷Ä’° ÷É’∏’≠’°÷Ä’•’∂:" },
        "‘≤’°’≠’ø’°’æ’∏÷Ä": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/6qVNBZ6T/’¢’°’≠’ø’°’æ’∏÷Ä.png", desc: "’à÷Ç’∂’´ ’•÷Ä’Ø’∏÷Ç ’Ø’µ’°’∂÷Ñ: ‘µ’©’• ’£’´’∑’•÷Ä’® ’∂÷Ä’° ’æ÷Ä’° ’Ø÷Ä’°’Ø’∏÷Ç’¥ ’•’∂ ’Ø’°’¥ ÷Å’•÷Ä’•’Ø’® ’∞’•’º’°÷Å’∂’∏÷Ç’¥ ’•’∂, ’∂’° ’°’º’°’ª’´’∂ ’°’∂’£’°’¥ ’π’´ ’¨÷Ñ’∏÷Ç’¥ ’≠’°’≤’®:" },
        "’î’°’≤’°÷Ñ’°÷Å’´": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/7YDkmKX1/÷Ñ’°’≤’°÷Ñ’°÷Å’´.png", desc: "’Ä’°’Ω’°÷Ä’°’Ø ’Ø’°÷Ä’¥’´÷Ä ’≠’°’≤’°÷Å’∏’≤: ’Ü÷Ä’° ’¶’•’∂÷Ñ’® ’ø÷Ä’°’¥’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂’∂ ’ß ÷á ÷Å’•÷Ä’•’Ø’°’µ’´’∂ ÷Ñ’æ’•’°÷Ä’Ø’∏÷Ç’©’µ’∏÷Ç’∂’®:" },
        "‘º÷Ä’°’£÷Ä’∏’≤": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/j5gqJhw4/larry-king-01-gty-llr-210102-1609623448458-hp-Main.jpg", desc: "‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’≠’°’≤’´ ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ ’®’∂’§’°’¥’•’∂’® 1 ’°’∂’£’°’¥: ‘∏’∂’ø÷Ä’∏÷Ç’¥ ’ß ’•÷Ä’Ø’∏÷Ç ’≠’°’≤’°÷Å’∏’≤’´ ÷á ’∫’°÷Ä’¶’∏÷Ç’¥’ù ’∂÷Ä’°’∂÷Ñ ’∂’∏÷Ç’û’µ’∂ ’©’´’¥’´÷Å ’•’∂ (÷Ö÷Ä’´’∂’°’Ø’ù ’•÷Ä’Ø’∏÷Ç’Ω’∂ ’ß’¨ ’Ω÷á ’Ø’°’¥ ’•÷Ä’Ø’∏÷Ç’Ω’∂ ’ß’¨ ’Ø’°÷Ä’¥’´÷Ä), ’©’•’û ’ø’°÷Ä’¢’•÷Ä:" },
        "’é÷Ä’´’™’°’º’∏÷Ç": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://miro.medium.com/v2/resize:fit:720/format:webp/1*So80rD8bCJbJ47OkT4SuYg.jpeg", desc: "‘µ’©’• ’∂÷Ä’°’∂ ’£’´’∑’•÷Ä’® ’Ω’∫’°’∂’∏÷Ç’¥ ’•’∂, ’∂’° ’π’´ ’¥’°’∞’°’∂’∏÷Ç’¥ ’¥’´’°’µ’∂’°’Ø: ’Ü’° ’´÷Ä’°’æ’∏÷Ç’∂÷Ñ ’ß ’Ω’ø’°’∂’∏÷Ç’¥ ’°’∂’¥’´’ª’°’∫’•’Ω ’Ø÷Ä’°’Ø’•’¨ ÷á ’´÷Ä ’∞’•’ø ’ø’°’∂’•’¨ ’¥’•’Ø ’°’µ’¨ ’≠’°’≤’°÷Å’∏’≤’´:" },
        "‘¥’°’ø’°’æ’∏÷Ä": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/7YDG8K3R/datavor.png", desc: "’ë’•÷Ä’•’Ø’°’µ’´’∂ ÷Ñ’æ’•’°÷Ä’Ø’∏÷Ç’©’µ’°’∂ ’™’°’¥’°’∂’°’Ø, ’•’©’• ’´’∂’π-’∏÷Ä ’¥’•’Ø’´’∂ ’∞’•’º’°÷Å’∂’∏÷Ç’¥ ’•’∂, ‘¥’°’ø’°’æ’∏÷Ä’® ’Ø’°÷Ä’∏’≤ ’ß ’¥’•’Ø ’°’∂’£’°’¥ ’≠’°’≤’´ ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ ÷Å’∏÷Ç’µ÷Å ’ø’°’¨ ’´÷Ä ’§’•÷Ä’® ÷á ’π’•’≤’°÷Ä’Ø’•’¨ ’°’µ’§ ÷Ñ’æ’•’°÷Ä’Ø’∏÷Ç’©’µ’∏÷Ç’∂’®’ù ÷É÷Ä’Ø’•’¨’∏’æ ’≠’°’≤’°÷Å’∏’≤’´’∂:" },
        "’î’°’≤’°÷Ñ’°’∫’•’ø": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://i.postimg.cc/wTwsHhT5/k'agak'apet.png", desc: "’î’°’≤’°÷Ñ’´ ’≤’•’Ø’°’æ’°÷Ä’∂ ’ß: ’Ü÷Ä’° ’±’°’µ’∂’® ÷Å’•÷Ä’•’Ø’°’µ’´’∂ ÷Ñ’æ’•’°÷Ä’Ø’∏÷Ç’©’µ’°’∂ ’™’°’¥’°’∂’°’Ø ’∞’°’æ’°’Ω’°÷Ä ’ß 2 ’±’°’µ’∂’´:" },
        "‘π’°÷É’°’º’°’∑÷Ä’ª’´’Ø": { team: "‘ø‘±’ê’Ñ‘ª’ê", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Charlie_Chaplin.jpg/800px-Charlie_Chaplin.jpg", desc: "’â’∏÷Ç’∂’´ ’Ω’•÷É’°’Ø’°’∂ ’ø’∏÷Ç’∂, ’°’µ’§ ’∫’°’ø’≥’°’º’∏’æ ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷Ñ’∂’∏÷Ç’¥ ’ß ’¥’•’Ø’´ ’ø’°’∂’®: ‘µ’©’• ’¥’°÷Ü’´’°’∂ ’£’° ’∂÷Ä’° ’ø’∏÷Ç’∂, ’∂÷Ä’°’∂ ’π’•’∂ ’£’ø’∂’´: ‘≤’°’µ÷Å ’•’©’• ’¥’°÷Ü’´’°’∂ ’£’∂’° ’°’µ’∂ ’¥’°÷Ä’§’∏÷Ç ’ø’∏÷Ç’∂, ’∏÷Ç’¥ ’∞’µ’∏÷Ç÷Ä ’ß ’£’∂’°÷Å’•’¨ ‘π’°÷É’°’º’°’∑÷Ä’ª’´’Ø’®, ’•÷Ä’Ø’∏÷Ç’Ω’∂ ’ß’¨ ’Ø’¥’°’∞’°’∂’°’∂:" },

        "’Ñ’°÷Ü’´’°": { team: "’ç‘µ’é", img: "https://i.postimg.cc/yYPz50rt/’¥’°÷Ü’´’∏’¶.png", desc: "’ç÷á ’©’´’¥’´ ’¶’´’∂’æ’∏÷Ä’∂ ’ß: ‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ‘¥’∏’∂’´ ’∞’•’ø ÷á ’Ø÷Ä’°’Ø’∏÷Ç’¥ ’¥’•’Ø ’Ø’°÷Ä’¥’´÷Ä ’≠’°’≤’°÷Å’∏’≤’´ ’æ÷Ä’°:" },
        "‘¥’∏’∂": { team: "’ç‘µ’é", img: "https://i.postimg.cc/Y0NwtF2h/’§’∏’∂.jpg", desc: "’Ñ’°÷Ü’´’°’µ’´ ’∫’°÷Ä’°’£’¨’∏÷Ç’≠’∂ ’ß: ‘≥’´’∑’•÷Ä’® ’°÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß, ’Ø’°’¶’¥’°’Ø’•÷Ä’∫’∏÷Ç’¥ ’Ω’∫’°’∂’∏÷Ç’©’µ’∏÷Ç’∂’® ÷á ÷É’∂’ø÷Ä’∏÷Ç’¥ ’á’•÷Ä’´÷Ü’´’∂:" },
        "‘ø’∏’∂’ø÷Ä’°’£’•’∂’ø": { team: "’ç‘µ’é", img: "https://i.postimg.cc/zfzBvz7D/’Ø’∏’∂’ø÷Ä’°’£’•’∂’ø.png", desc: "’ç÷á ’≠’°’≤’°÷Å’∏’≤ ’ß: ‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ÷á ÷É’∏÷Ä’±’∏÷Ç’¥ ’£’ø’∂’•’¨ ‘±’£’•’∂’ø’´’∂, ’∏÷Ä’∫’•’Ω’¶’´ ’Ω÷á’•÷Ä’® ’°’º’°’ª’´’∂’® ’∂÷Ä’°’∂ ’∞’•’º’°÷Å’∂’•’∂:" },
        "‘≥’∏’≤": { team: "’ç‘µ’é", img: "https://i.postimg.cc/j26rRfq2/’£’∏’≤.png", desc: "’ç÷á ’≠’°’≤’°÷Å’∏’≤ ’ß: ‘±÷Ä’©’∂’°’∂’∏÷Ç’¥ ’ß ’£’´’∑’•÷Ä’® ÷á ’¶÷Ä’Ø’∏÷Ç’¥ ’¥’•’Ø ’≠’°’≤’°÷Å’∏’≤’´ ’´÷Ä ’°’Ø’ø’´’æ ’∏÷Ç’∂’°’Ø’∏÷Ç’©’µ’∏÷Ç’∂’´÷Å ’ø’æ’µ’°’¨ ’£’´’∑’•÷Ä:" },
        "‘≥’•’≤’•÷Å’Ø’∏÷Ç’∞’´": { team: "’ç‘µ’é", img: "https://i.postimg.cc/xdfC8f51/’£’•’≤’•÷Å’Ø’∏÷Ç’∞’´.png", desc: "‘±’µ÷Å’•’¨’∏÷Ç’¥ ’ß ’¥’•’Ø’´’∂ ÷á ’¨’º’•÷Å’∂’∏÷Ç’¥ ’∂÷Ä’°’∂ ’∞’°’ª’∏÷Ä’§ ÷Ö÷Ä’æ’° ’∞’°’¥’°÷Ä:" },
        "’Ä’•’≤’°÷É’∏’≠’°’Ø’°’∂": { team: "’ç‘µ’é", img: "https://i.postimg.cc/fLFtQ5Rk/rev.webp", desc: "’ç÷á ’≠’°’≤’°÷Å’∏’≤ ’ß: ‘Ω’°’≤’´ ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ ’¥’•’Ø ’°’∂’£’°’¥ ’®’∂’ø÷Ä’∏÷Ç’¥ ’ß ’¥’•’Ø ’≠’°’≤’°÷Å’∏’≤’´ (’Ø’°÷Ä’∏’≤ ’ß ’∂’°÷á ’´÷Ä’•’∂), ’∏÷Ä’´÷Å ’∞’•’ø’∏ ’∏’≤’ª ’≠’°’≤’´ ’®’∂’©’°÷Å÷Ñ’∏÷Ç’¥ ’•÷Ä’¢ ’á’•÷Ä’´÷Ü’® ’Ø’°’¥ ’Ä’∏’£÷á’∏÷Ä’°’Ø’°’∂’® ’Ω’ø’∏÷Ç’£’•’∂ ’°’µ’§ ’¥’°÷Ä’§’∏÷Ç’∂, ’∂÷Ä’°’∂÷Ñ ’Ø’Ω’ø’°’∂’°’∂ ’ç‘Ω‘±‘º ’∫’°’ø’°’Ω’≠’°’∂ (‘ø’°÷Ä’¥’´÷Ä’® ’Ø’•÷Ä÷á’° ’ç÷á, ’´’Ω’Ø ’ç÷á’®’ù ‘ø’°÷Ä’¥’´÷Ä):" },
        "’ì’°’Ω’ø’°’¢’°’∂": { team: "’ç‘µ’é", img: "https://upload.wikimedia.org/wikipedia/en/3/34/Jimmy_McGill_BCS_S3.png", desc: "’ç÷á ’©’´’¥’´ ’∫’°’∑’ø’∫’°’∂’∂ ’ß: ‘±’¥’•’∂ ’£’´’∑’•÷Ä ’®’∂’ø÷Ä’∏÷Ç’¥ ’ß ’¥’°÷Ü’´’°’µ’´ ’°’∂’§’°’¥’∂’•÷Ä’´÷Å ’¥’•’Ø’´’∂: ‘µ’©’• ’á’•÷Ä’´÷Ü’® ’Ω’ø’∏÷Ç’£’´ ’°’µ’§ ’¥’°÷Ä’§’∏÷Ç’∂, ’∂’° ’Ø’•÷Ä÷á’° ’∏÷Ä’∫’•’Ω ‘ø‘±’ê’Ñ‘ª’ê (’Ñ’°÷Ñ’∏÷Ç÷Ä):" },
        "‘±’∞’°’¢’•’Ø’´’π": { team: "’ç‘µ’é", img: "https://i0.wp.com/bamfstyle.com/wp-content/uploads/2025/11/NC4OM-Anton-MAIN1b.jpg?ssl=1", desc: "‘µ’©’• ÷Å’•÷Ä’•’Ø’® ’∂÷Ä’°’∂ ÷Ñ’æ’•’°÷Ä’Ø’∏÷Ç’©’µ’°’¥’¢ ’∞’•’º’°÷Å’∂’∏÷Ç’¥ ’•’∂, ’∂’° ’Ø’°÷Ä’∏’≤ ’ß ’®’∂’ø÷Ä’•’¨ ÷Å’°’∂’Ø’°÷Å’°’Æ ’≠’°’≤’°÷Å’∏’≤’´ ÷á ’∫’°’µ’©’•’¨ ’∂÷Ä’° ’∞’•’ø ’¥’´’°’Ω’´’∂:" },
        "’ç÷á ‘ø’°÷Ä’§’´’∂’°’¨": { team: "’ç‘µ’é", img: "https://i.postimg.cc/4N7WhN7h/kardinal.png", desc: "’ç÷á ’≠’°’≤’°÷Å’∏’≤ ’ß, ’Ω’°’Ø’°’µ’∂ ’£’´’∑’•÷Ä’® ¬´’Ñ’°÷Ü’´’°’µ’´¬ª ’∞’•’ø ’π’´ ’°÷Ä’©’∂’°’∂’∏÷Ç’¥ ÷á ’π’´ ’¥’°’Ω’∂’°’Ø÷Å’∏÷Ç’¥ ’Ø÷Ä’°’Ø’∏÷Å’´’∂÷â ‘±’º’°’ª’´’∂ ’£’´’∑’•÷Ä’®, ’¥’°÷Ü’´’°’µ’´ ÷Ñ’∂’•’¨’∏÷Ç÷Å ’∞’•’ø’∏, ’≠’°’≤’°’æ’°÷Ä’® ’∂÷Ä’°’∂ ’°÷Ä’©’∂’°÷Å’∂’∏÷Ç’¥ ’ß ÷á ÷Å’∏÷Ç’µ÷Å ’ø’°’¨’´’Ω ’¢’∏’¨’∏÷Ä ’Ω÷á ’≠’°’≤’°÷Å’∏’≤’∂’•÷Ä’´’∂ (’°’µ’§ ’©’æ’∏÷Ç’¥’ù ‘±’£’•’∂’ø’´’∂)’ù ’°’º’°’∂÷Å ’§’•÷Ä’•÷Ä’® ’∞’Ω’ø’°’Ø’•÷Å’∂’•’¨’∏÷Ç÷â" },

        "’Ñ’∏’¨’°’£’°÷Ä": { team: "’â‘µ‘∂’à’î", img: "https://i.postimg.cc/6qf7SZy7/hegap'oxakan.png", desc: "’â’•’¶’∏÷Ñ ’≠’°’≤’°÷Å’∏’≤ ’ß, ’∏÷Ä’® ’Ø’°÷Ä’∏’≤ ’ß ’°’¥’•’∂ ’£’´’∑’•÷Ä ’Ω’∫’°’∂’•’¨ ÷Å’°’∂’Ø’°÷Å’°’Æ ’≠’°’≤’°÷Å’∏’≤’´:" },
        "‘æ’°’≤÷Ä’°’Æ’∏÷Ç": { team: "’â‘µ‘∂’à’î", img: "https://res.cloudinary.com/ybmedia/image/upload/c_crop,h_1000,w_1500,x_0,y_0/c_fill,f_auto,h_1200,q_auto,w_1600/v1/m/c/1/c12ba0e04ac29056b564b890ebf5d49b6296139e/20-best-horror-films-franchises-featuring-scary.jpg", desc: "‘Ω’•’¨’°’£’°÷Ä ’Ø’•÷Ä’∫’°÷Ä ’ß: ’Ü÷Ä’° ’¥’´’°’Ø ’∂’∫’°’ø’°’Ø’∂ ’ß, ’∏÷Ä’∫’•’Ω’¶’´ ÷Å’•÷Ä’•’Ø’°’µ’´’∂ ÷Ñ’æ’•’°÷Ä’Ø’∏÷Ç’©’µ’°’∂ ’™’°’¥’°’∂’°’Ø ’´÷Ä’•’∂ ’∞’•’º’°÷Å’∂’•’∂: ‘µ’©’• ’∂÷Ä’°’∂ ’∞’°’∂’∏÷Ç’¥ ’•’∂ ’≠’°’≤’´÷Å, ’∂’° ’Ä‘±’Ç‘π’à’í’Ñ ‘∑:" }
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentRoomCode = "", myId = "", isHost = false, lastDeleted = null, lastAddedCanId = null;

    window.onload = () => {
        const savedName = localStorage.getItem('mafia_player_name');
        if(savedName) document.getElementById('p-name').value = savedName;
    };

    function calculate() {
        let r = 0, b = 0, n = 0;
        document.querySelectorAll('.r-role-input').forEach(i => r += Math.max(0, parseInt(i.value) || 0));
        document.querySelectorAll('.b-role-input').forEach(i => b += Math.max(0, parseInt(i.value) || 0));
        document.querySelectorAll('.n-role-input').forEach(i => n += Math.max(0, parseInt(i.value) || 0));
        document.getElementById('setup-total-red').innerText = r;
        document.getElementById('setup-total-black').innerText = b;
        document.getElementById('setup-total-neutral').innerText = n;
        document.getElementById('setup-total-all').innerText = r + b + n;
    }

    function goBack(id) {
        document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function exitGameAndReset() {
        if(confirm("‘¥’∏÷Ç÷Ä’Ω ’£’°’û’¨ ÷á ’°’¥’¢’∏’≤’ª’∏÷Ç’©’µ’°’¥’¢ ’¶÷Ä’∏’µ’°÷Å’∂’•’¨ ’Ω’•’∂’µ’°’Ø’®:")) {
            if(currentRoomCode) {
                db.ref('rooms/' + currentRoomCode).remove().then(() => { location.reload(); });
            } else { location.reload(); }
        }
    }

    function toggleCatalog() {
        const overlay = document.getElementById('roles-catalog-overlay');
        overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';
    }

    function startHost() {
        isHost = true;
        let roles = [];
        document.querySelectorAll('.role-count').forEach(i => {
            let val = Math.max(0, parseInt(i.value) || 0);
            for(let k=0; k<val; k++) roles.push(i.getAttribute('data-name'));
        });
        currentRoomCode = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('room-code-txt').innerText = currentRoomCode;
        db.ref('rooms/' + currentRoomCode).set({ roles: roles, voting: { state: "idle" } });
        goBack('host-lobby');
        db.ref('rooms/' + currentRoomCode + '/players').on('value', snap => renderAdmin(snap.val()));
        db.ref('rooms/' + currentRoomCode + '/voting').on('value', snap => updateAdminVotes(snap.val()));
    }

    function renderAdmin(players) {
        if(!players) { document.getElementById('player-list-admin').innerHTML = "<p>’ç’∫’°’Ω’∏÷Ç’¥ ’•’∂÷Ñ ’¥’°’Ω’∂’°’Ø’´÷Å’∂’•÷Ä’´...</p>"; return; }
        let html = `<table class="admin-table">`;
        Object.keys(players).forEach(id => {
            let p = players[id];
            let tm = roleData[p.role]?.team;
            let clr = tm === "‘ø‘±’ê’Ñ‘ª’ê" ? "role-red-text" : (tm === "’ç‘µ’é" ? "role-black-text" : "role-neutral-text");
            html += `<tr><td>${p.name}</td><td class="${clr}">${p.role}</td><td style="text-align:right;">
                <button class="candidate-btn" onclick="addCan('${id}', '${p.name}')">üó≥Ô∏è</button>
                <button class="kick-btn" onclick="kick('${id}', '${p.name}', '${p.role}')">‚ùå</button>
            </td></tr>`;
        });
        document.getElementById('player-list-admin').innerHTML = html + `</table>`;
        document.getElementById('vote-admin-area').classList.remove('hidden');
    }

    function kick(id, n, r) { 
        if(confirm("’Ä’•’º’°÷Å’∂’•’û’¨ " + n)) { lastDeleted = {n, r}; db.ref('rooms/' + currentRoomCode + '/players/' + id).remove(); }
    }

    function undoLastAction() {
        if(lastAddedCanId) { db.ref('rooms/' + currentRoomCode + '/voting/candidates/' + lastAddedCanId).remove(); lastAddedCanId = null; }
        else if(lastDeleted) { db.ref('rooms/' + currentRoomCode + '/players').push({ name: lastDeleted.n, role: lastDeleted.r }); lastDeleted = null; }
    }

    function addCan(id, n) { lastAddedCanId = id; db.ref('rooms/' + currentRoomCode + '/voting/candidates/' + id).set({ name: n }); }

    function toggleVotingState() {
        db.ref('rooms/' + currentRoomCode + '/voting/state').once('value', snap => {
            let currentState = snap.val();
            if (currentState === "active") {
                db.ref('rooms/' + currentRoomCode + '/voting/state').set("finished");
            } else {
                db.ref('rooms/' + currentRoomCode + '/voting').update({ state: "active", results: {} });
            }
        });
    }

    function clearVoteData() { 
        db.ref('rooms/' + currentRoomCode + '/voting').set({ state: "idle", candidates: {}, results: {} }); 
        lastAddedCanId = null; 
    }

    function updateAdminVotes(v) {
        const btn = document.getElementById('host-vote-control-btn');
        if(v && v.state === "active") { btn.innerText = "‘±’é‘±’ê’è‘µ‘º ’î’é‘µ‘±’ê‘ø’à’í‘π’Ö’à’í’Ü‘∏ üõë"; btn.classList.add('stop-btn'); }
        else if (v && v.state === "finished") { btn.innerText = "‘±’é‘±’ê’è’é‘±‘æ ‘∑ ‚úÖ"; btn.disabled = true; btn.classList.remove('stop-btn'); }
        else { btn.innerText = "’ç‘ø’ç‘µ‘º"; btn.disabled = false; btn.classList.remove('stop-btn'); }

        if(!v || !v.candidates) { document.getElementById('candidate-list-admin').innerHTML = ""; return; }
        let html = "", counts = {};
        if(v.results) Object.values(v.results).forEach(cid => counts[cid] = (counts[cid] || 0) + 1);
        Object.keys(v.candidates).forEach(cid => {
            html += `<div class="candidate-row"><span>üë§ ${v.candidates[cid].name}</span> <b>${counts[cid] || 0} ’±’°’µ’∂</b></div>`;
        });
        document.getElementById('candidate-list-admin').innerHTML = html;
    }

    function joinNow() {
        let c = document.getElementById('join-code').value, n = document.getElementById('p-name').value;
        if(!c || !n) return alert("‘º÷Ä’°÷Å÷Ä’•÷Ñ ’§’°’∑’ø’•÷Ä’®");
        localStorage.setItem('mafia_player_name', n);
        db.ref('rooms/' + c).once('value', snap => {
            if(!snap.exists()) return alert("’ç’•’∂’µ’°’Ø’® ’π’Ø’°");
            currentRoomCode = c;
            let pRef = db.ref('rooms/' + c + '/players').push();
            myId = pRef.key; pRef.set({ name: n, role: "’Ω’∫’°’Ω’•÷Ñ..." });
            goBack('role-display-panel');
            pRef.on('value', ps => { if(!ps.exists()) location.reload(); else renderInfo(ps.val(), n); });
            db.ref('rooms/' + c + '/voting').on('value', vs => renderVoteModal(vs.val()));
        });
    }

    function renderInfo(p, name) {
        if(p.role === "’Ω’∫’°’Ω’•÷Ñ...") { document.getElementById('player-role-info').innerHTML = `<h3>’à’≤’ª’∏÷Ç’µ’∂ ${name}</h3><p>’ç’∫’°’Ω’•÷Ñ ’≠’°’≤’°’æ’°÷Ä’´’∂...</p>`; return; }
        const d = roleData[p.role];
        let tmColor = d.team === '‘ø‘±’ê’Ñ‘ª’ê' ? 'var(--red-team)' : (d.team === '’ç‘µ’é' ? 'var(--blue-team)' : 'var(--neutral-team)');
        document.getElementById('player-role-info').innerHTML = `
            <h2 style="margin-bottom:5px;">${name}</h2>
            <div class="role-card">
                <div class="role-image-container"><img src="${d.img}" class="role-img"></div>
                <div class="role-name-text">${p.role}</div>
                <div class="desc-box"><b>‘π’´’¥’ù <span style="color:${tmColor}">${d.team}</span></b><p class="desc-text">${d.desc}</p></div>
            </div>`;
    }

    function renderVoteModal(v) {
        const overlay = document.getElementById('vote-modal-overlay');
        const listArea = document.getElementById('candidate-list-player');
        const resultsArea = document.getElementById('vote-results-player');
        const title = document.getElementById('player-vote-title');

        if(!v || v.state === "idle") { overlay.style.display = 'none'; return; }
        overlay.style.display = 'flex';

        if (v.state === "active") {
            title.innerText = "üó≥Ô∏è ’î’é‘µ‘±’ê‘ø’à’í‘π’Ö’à’í’Ü";
            resultsArea.classList.add('hidden');
            listArea.classList.remove('hidden');
            if(v.results && v.results[myId]) {
                listArea.innerHTML = "<p style='color:var(--gold); font-size:1.4em;'>’Å’•÷Ä ÷Ñ’æ’•’∂ ’®’∂’§’∏÷Ç’∂’æ’°’Æ ’ß, ’Ω’∫’°’Ω’•÷Ñ ’°’æ’°÷Ä’ø’´’∂:</p>";
            } else {
                let h = "";
                if(v.candidates) Object.keys(v.candidates).forEach(cid => { h += `<button class="host-btn" style="background:#333; margin-bottom:10px;" onclick="castVote('${cid}')">${v.candidates[cid].name}</button>`; });
                listArea.innerHTML = h || "‘π’•’Ø’∂’°’Æ’∏÷Ç’∂’•÷Ä ’π’Ø’°’∂";
            }
        } else if (v.state === "finished") {
            title.innerText = "üìä ‘±’ê‘¥’Ö’à’í’Ü’î’Ü‘µ’ê";
            listArea.classList.add('hidden');
            resultsArea.classList.remove('hidden');
            let h = "", counts = {};
            if(v.results) Object.values(v.results).forEach(cid => counts[cid] = (counts[cid] || 0) + 1);
            Object.keys(v.candidates).forEach(cid => {
                h += `<div class="vote-result-row"><span>üë§ ${v.candidates[cid].name}</span> <b>${counts[cid] || 0}</b></div>`;
            });
            resultsArea.innerHTML = h;
        }
    }

    function castVote(cid) { db.ref('rooms/' + currentRoomCode + '/voting/results/' + myId).set(cid); }

    function distributeFinal() {
        db.ref('rooms/' + currentRoomCode).once('value', snap => {
            let data = snap.val(), keys = shuffle(Object.keys(data.players)), roles = shuffle([...data.roles]);
            while(roles.length < keys.length) roles.push("’î’°’≤’°÷Ñ’°÷Å’´");
            keys.forEach((k, i) => db.ref('rooms/' + currentRoomCode + '/players/' + k).update({ role: roles[i] }));
            document.getElementById('dist-btn').style.display = "none";
        });
    }

    function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }

    function initCatalog() {
        const rList = document.getElementById('red-cat-list');
        const bList = document.getElementById('black-cat-list');
        const nList = document.getElementById('neutral-cat-list');
        
        const rInp = document.getElementById('setup-red-inputs');
        const bInp = document.getElementById('setup-black-inputs');
        const nInp = document.getElementById('setup-neutral-inputs');

        for(let r in roleData) {
            const tm = roleData[r].team;
            let targetList = rList, targetInp = rInp, inputClass = 'r-role-input', colorVar = 'var(--red-team)';
            
            if (tm === "’ç‘µ’é") { 
                targetList = bList; targetInp = bInp; inputClass = 'b-role-input'; colorVar = 'var(--blue-team)'; 
            } else if (tm === "’â‘µ‘∂’à’î") { 
                targetList = nList; targetInp = nInp; inputClass = 'n-role-input'; colorVar = 'var(--neutral-team)'; 
            }

            const pill = document.createElement('div'); pill.className = `role-pill`; 
            pill.style.borderLeft = `4px solid ${colorVar}`;
            pill.innerHTML = `<span>${r}</span> <span>‚ûú</span>`;
            pill.onclick = () => {
                const d = roleData[r];
                let descColor = d.team === "‘ø‘±’ê’Ñ‘ª’ê" ? "var(--red-team)" : (d.team === "’ç‘µ’é" ? "var(--blue-team)" : "var(--neutral-team)");
                document.getElementById('preview-content').innerHTML = `<div class="role-card"><div class="role-image-container"><img src="${d.img}" class="role-img"></div><div class="role-name-text">${r}</div><div class="desc-box"><b style="color:${descColor}">${d.team}</b><p class="desc-text">${d.desc}</p></div></div>`;
                document.getElementById('role-preview-modal').classList.remove('hidden');
            };
            targetList.appendChild(pill);

            const row = document.createElement('div'); row.className = 'role-row';
            row.innerHTML = `<label>${r}</label><input type="number" min="0" class="role-count ${inputClass}" data-name="${r}" value="${['’á’•÷Ä’´÷Ü','‘≤’™’´’∑’Ø','’Ñ’°÷Ü’´’°','‘¥’∏’∂'].includes(r) ? 1 : 0}" oninput="calculate()">`;
            targetInp.appendChild(row);
        }
        calculate();
    }
    function closePreview() { document.getElementById('role-preview-modal').classList.add('hidden'); }
    function showJoinPanel() { goBack('join-panel'); }
    initCatalog();
</script>
</body>
</html>
